{% extends 'base.html' %}

{% block title %}Home - Blogify{% endblock %}

{% block head %}
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="text-center mb-12">
  <h1 class="font-serif text-5xl font-bold text-dark mb-4">Discover Stories</h1>
  <p class="text-secondary text-lg max-w-2xl mx-auto">Explore thoughtful articles, creative ideas, and inspiring content from our community of writers.</p>
</div>

<!-- Search & Filter Section -->
<div class="bg-white rounded-2xl shadow-sm border border-accent p-6 mb-8">
  <form method="GET" action="{{ url_for('public.search') }}" class="space-y-4">

    <!-- Main Search -->
    <div class="flex gap-3">
      <input type="text" name="q" placeholder="Search articles..." value="{{ query or '' }}" 
             class="flex-1 px-4 py-3 border border-accent rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200">
      <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg font-medium hover:bg-opacity-90 transition-all duration-200 shadow-sm">
        Search
      </button>
    </div>

    <!-- Filter Panel -->
    <div class="flex flex-wrap gap-3">
      <select name="filter_type" class="px-4 py-2 border border-accent rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm" onchange="toggleFilterInputs(this.value)">
        <option value="">Filter by...</option>
        <option value="tag" {% if tag_filter %}selected{% endif %}>Tag</option>
        <option value="publisher" {% if publisher_filter %}selected{% endif %}>Publisher</option>
      </select>

      <input type="text" name="tag" id="tag-input" placeholder="Enter tag"
             value="{{ tag_filter or '' }}" class="px-4 py-2 border border-accent rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm" style="display: none;">

      <select name="publisher" id="publisher-select" class="px-4 py-2 border border-accent rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm" style="display: none;">
        <option value="">Select Publisher</option>
        {% for pub in publishers %}
          <option value="{{ pub.user_id }}" {% if publisher_filter == pub.user_id|string %}selected{% endif %}>
            {{ pub.username }}
          </option>
        {% endfor %}
      </select>

      <button type="submit" class="px-5 py-2 bg-secondary text-white rounded-lg text-sm font-medium hover:bg-opacity-90 transition-all duration-200">
        Apply Filter
      </button>
    </div>
  </form>
</div>

<!-- Post List -->
{% if posts.items %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
    {% for post in posts.items %}
      <article class="bg-white rounded-xl shadow-sm border border-accent overflow-hidden hover:shadow-md transition-all duration-300 group">
        <div class="p-6 space-y-4">
          <h2 class="font-serif text-xl font-bold text-dark group-hover:text-primary transition-colors duration-200">
            <a href="{{ url_for('publisher.show_post', post_id=post.id) }}">{{ post.title }}</a>
          </h2>
          
          <div class="flex items-center text-sm text-secondary space-x-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span>{{ post.author.username if post.author else 'Unknown' }}</span>
            <span>•</span>
            <span>{{ post.created_at.strftime('%b %d, %Y') }}</span>
          </div>
          
          {% if post.tags %}
            <div class="flex flex-wrap gap-2">
              {% for tag in post.tags.split(',') %}
                <span class="px-3 py-1 bg-accent text-secondary text-xs rounded-full">{{ tag.strip() }}</span>
              {% endfor %}
            </div>
          {% endif %}
          
          <a href="{{ url_for('publisher.show_post', post_id=post.id) }}" 
             class="inline-flex items-center text-primary font-medium text-sm hover:text-secondary transition-colors duration-200">
            Read More
            <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
      </article>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div class="flex justify-center items-center space-x-2">
    {% if posts.has_prev %}
      <a href="{{ url_for('public.search', q=query, tag=tag_filter, publisher=publisher_filter, page=posts.prev_num) }}" 
         class="px-4 py-2 bg-white border border-accent rounded-lg text-secondary hover:bg-accent transition-all duration-200">
        ← Previous
      </a>
    {% endif %}

    {% for page_num in range(1, posts.pages + 1) %}
      {% if page_num == posts.page %}
        <span class="px-4 py-2 bg-primary text-white rounded-lg font-medium">{{ page_num }}</span>
      {% else %}
        <a href="{{ url_for('public.search', q=query, tag=tag_filter, publisher=publisher_filter, page=page_num) }}" 
           class="px-4 py-2 bg-white border border-accent rounded-lg text-secondary hover:bg-accent transition-all duration-200">
          {{ page_num }}
        </a>
      {% endif %}
    {% endfor %}

    {% if posts.has_next %}
      <a href="{{ url_for('public.search', q=query, tag=tag_filter, publisher=publisher_filter, page=posts.next_num) }}" 
         class="px-4 py-2 bg-white border border-accent rounded-lg text-secondary hover:bg-accent transition-all duration-200">
        Next →
      </a>
    {% endif %}
  </div>
{% else %}
  <div class="text-center py-16">
    <svg class="w-16 h-16 mx-auto text-accent mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <p class="text-secondary text-lg">No posts found. Try adjusting your search.</p>
  </div>
{% endif %}

<script>
  function toggleFilterInputs(value) {
    const tagInput = document.getElementById("tag-input");
    const publisherSelect = document.getElementById("publisher-select");

    if (value === "tag") {
      tagInput.style.display = "block";
      publisherSelect.style.display = "none";
    } else if (value === "publisher") {
      tagInput.style.display = "none";
      publisherSelect.style.display = "block";
    } else {
      tagInput.style.display = "none";
      publisherSelect.style.display = "none";
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const currentType = "{{ 'tag' if tag_filter else 'publisher' if publisher_filter else '' }}";
    if (currentType) toggleFilterInputs(currentType);
  });
</script>
{% endblock %}
